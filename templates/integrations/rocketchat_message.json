{% load hc_extras humanize %}
{
    "alias": "{% site_name %}",
    "avatar": "{% absolute_site_logo_url %}",
    "text": "[{{ check.name_then_code|escapejs }}]({{ check.cloaked_url }}) is {{ check.status|upper }}.",
    "attachments": [{
        {% if check.status == "up" %}
            "color": "#5cb85c",
        {% else %}
            "color": "#d9534f",
        {% endif %}
        "fields": [
            {% if check.desc %}
            {
                "title": "Description",
                "value": "{{ check.desc|escapejs }}"
            },
            {% endif %}

            {% if check.project.name %}
            {
                "title": "Project",
                "value": "{{ check.project.name|escapejs }}",
                "short": true
            },
            {% endif %}

            {% if check.tags_list %}
            {
                "title": "Tags",
                "value": "{% for tag in check.tags_list %}`{{ tag|escapejs }}` {% endfor %}",
                "short": true
            },
            {% endif %}

            {% if check.kind == "simple" %}
            {
                "title": "Period",
                "value": "{{ check.timeout|hc_duration }}",
                "short": true
            },
            {% elif check.kind == "cron" %}
            {
                "title": "Schedule",
                "value": "{{ check.schedule|fix_asterisks|escapejs }}",
                "short": true
            },
            {% endif %}

            {
                "title": "Total Pings",
                "value": "{{ check.n_pings }}",
                "short": true
            },

            {
                "title": "Last Ping",
                {% if ping is None %}
                "value": "Never",
                {% elif ping.kind == "ign" %}
                "value": "Ignored, {{ ping.created|naturaltime }}",
                {% elif ping.kind == "fail" or ping.exitstatus > 0 %}
                "value": "Failure, {{ ping.created|naturaltime }}",
                {% elif ping.kind == "start" %}
                "value": "Start, {{ ping.created|naturaltime }}",
                {% elif ping.kind == "log" %}
                "value": "Log, {{ ping.created|naturaltime }}",
                {% else %}
                "value": "Success, {{ ping.created|naturaltime }}",
                {% endif %}
                "short": true
            }
            {% with body_size=ping.get_body_size %}
            {% if body_size > 0 %}
            ,{
                "title":"Last Ping Body",
                "value": "{{ body_size }} byte{{ body_size|pluralize }}, [show body]({{ check.cloaked_url }}#ping-{{ ping.n }})"
            }
            {% endif %}
            {% endwith %}
        ]
    }]
}
